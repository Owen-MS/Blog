<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件原理 | 黑木小课堂开课了</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="waiting for some one">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.5b7f5b2e.css" as="style"><link rel="preload" href="/Blog/assets/js/app.f375fe27.js" as="script"><link rel="preload" href="/Blog/assets/js/2.c88ae757.js" as="script"><link rel="preload" href="/Blog/assets/js/3.acab97b8.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.f427b6bd.js"><link rel="prefetch" href="/Blog/assets/js/11.9f304a35.js"><link rel="prefetch" href="/Blog/assets/js/12.30354b1f.js"><link rel="prefetch" href="/Blog/assets/js/13.95eae7c7.js"><link rel="prefetch" href="/Blog/assets/js/14.00cadfd8.js"><link rel="prefetch" href="/Blog/assets/js/15.7e69b1b3.js"><link rel="prefetch" href="/Blog/assets/js/16.86c1a2b9.js"><link rel="prefetch" href="/Blog/assets/js/17.e83a8852.js"><link rel="prefetch" href="/Blog/assets/js/18.92355088.js"><link rel="prefetch" href="/Blog/assets/js/19.8957735b.js"><link rel="prefetch" href="/Blog/assets/js/20.9a915d6e.js"><link rel="prefetch" href="/Blog/assets/js/21.85678c64.js"><link rel="prefetch" href="/Blog/assets/js/22.2c0d25ad.js"><link rel="prefetch" href="/Blog/assets/js/23.21d51aaa.js"><link rel="prefetch" href="/Blog/assets/js/24.3f674744.js"><link rel="prefetch" href="/Blog/assets/js/25.dacf3e23.js"><link rel="prefetch" href="/Blog/assets/js/26.2d73d4ee.js"><link rel="prefetch" href="/Blog/assets/js/27.31409b2d.js"><link rel="prefetch" href="/Blog/assets/js/28.37d71dd3.js"><link rel="prefetch" href="/Blog/assets/js/29.f19180a1.js"><link rel="prefetch" href="/Blog/assets/js/30.9d4cc355.js"><link rel="prefetch" href="/Blog/assets/js/31.690356d1.js"><link rel="prefetch" href="/Blog/assets/js/32.7fc83c11.js"><link rel="prefetch" href="/Blog/assets/js/33.cf78d876.js"><link rel="prefetch" href="/Blog/assets/js/34.5bd1da2f.js"><link rel="prefetch" href="/Blog/assets/js/35.fb37de13.js"><link rel="prefetch" href="/Blog/assets/js/36.83a2a909.js"><link rel="prefetch" href="/Blog/assets/js/37.0bb65fa6.js"><link rel="prefetch" href="/Blog/assets/js/38.087596ab.js"><link rel="prefetch" href="/Blog/assets/js/39.0d56f966.js"><link rel="prefetch" href="/Blog/assets/js/4.5230782c.js"><link rel="prefetch" href="/Blog/assets/js/40.fcadfda4.js"><link rel="prefetch" href="/Blog/assets/js/41.dfef7bbe.js"><link rel="prefetch" href="/Blog/assets/js/42.db06ccfe.js"><link rel="prefetch" href="/Blog/assets/js/43.a7385a7e.js"><link rel="prefetch" href="/Blog/assets/js/44.5cf21fb0.js"><link rel="prefetch" href="/Blog/assets/js/45.78acc165.js"><link rel="prefetch" href="/Blog/assets/js/46.5c585071.js"><link rel="prefetch" href="/Blog/assets/js/47.85395c58.js"><link rel="prefetch" href="/Blog/assets/js/48.313c1cfa.js"><link rel="prefetch" href="/Blog/assets/js/49.5fafc2be.js"><link rel="prefetch" href="/Blog/assets/js/5.59a7f641.js"><link rel="prefetch" href="/Blog/assets/js/50.e3e1ae37.js"><link rel="prefetch" href="/Blog/assets/js/51.5ab1f37e.js"><link rel="prefetch" href="/Blog/assets/js/52.fcb023e8.js"><link rel="prefetch" href="/Blog/assets/js/53.5fa1c1ef.js"><link rel="prefetch" href="/Blog/assets/js/54.47d8c3fa.js"><link rel="prefetch" href="/Blog/assets/js/55.1b1649e8.js"><link rel="prefetch" href="/Blog/assets/js/56.5d99f046.js"><link rel="prefetch" href="/Blog/assets/js/57.cf117917.js"><link rel="prefetch" href="/Blog/assets/js/58.a932e8d4.js"><link rel="prefetch" href="/Blog/assets/js/59.306d018b.js"><link rel="prefetch" href="/Blog/assets/js/6.34fe87b9.js"><link rel="prefetch" href="/Blog/assets/js/60.9003beca.js"><link rel="prefetch" href="/Blog/assets/js/61.2a593451.js"><link rel="prefetch" href="/Blog/assets/js/62.025e604c.js"><link rel="prefetch" href="/Blog/assets/js/63.5182eb4a.js"><link rel="prefetch" href="/Blog/assets/js/64.327872a2.js"><link rel="prefetch" href="/Blog/assets/js/65.d528f6a9.js"><link rel="prefetch" href="/Blog/assets/js/66.e849914a.js"><link rel="prefetch" href="/Blog/assets/js/67.043b2815.js"><link rel="prefetch" href="/Blog/assets/js/68.71e6f142.js"><link rel="prefetch" href="/Blog/assets/js/69.47370d03.js"><link rel="prefetch" href="/Blog/assets/js/7.6a5ace96.js"><link rel="prefetch" href="/Blog/assets/js/70.f576c656.js"><link rel="prefetch" href="/Blog/assets/js/71.48ec8240.js"><link rel="prefetch" href="/Blog/assets/js/72.707b0cb5.js"><link rel="prefetch" href="/Blog/assets/js/73.1f985a34.js"><link rel="prefetch" href="/Blog/assets/js/74.593152e5.js"><link rel="prefetch" href="/Blog/assets/js/8.098db098.js"><link rel="prefetch" href="/Blog/assets/js/9.31cceed0.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.5b7f5b2e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">黑木小课堂开课了</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Blog/web/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/web/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/dataStructure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/Blog/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程" class="dropdown-title"><span class="title">工程</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程" class="mobile-dropdown-title"><span class="title">工程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/wheel/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/collect/skuPath/" class="nav-link">
  skuPath
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/JS/" class="nav-link">
  JS常见手写题
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/一套面试题/" class="nav-link">
  一套面试题
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/错误监控及上报/" class="nav-link">
  错误监控
</a></li></ul></div></div><div class="nav-item"><a href="/Blog/100/" class="nav-link">
  前端100问
</a></div><div class="nav-item"><a href="/Blog/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/Blog/diary/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="/Blog/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Owen-MS/Blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Blog/web/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/web/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/dataStructure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/Blog/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程" class="dropdown-title"><span class="title">工程</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程" class="mobile-dropdown-title"><span class="title">工程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/wheel/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/collect/skuPath/" class="nav-link">
  skuPath
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/JS/" class="nav-link">
  JS常见手写题
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/一套面试题/" class="nav-link">
  一套面试题
</a></li><li class="dropdown-item"><!----> <a href="/Blog/collect/错误监控及上报/" class="nav-link">
  错误监控
</a></li></ul></div></div><div class="nav-item"><a href="/Blog/100/" class="nav-link">
  前端100问
</a></div><div class="nav-item"><a href="/Blog/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/Blog/diary/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="/Blog/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Owen-MS/Blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/Blog/web/react/" class="sidebar-heading clickable router-link-active open"><span>React</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>原理篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/web/react/新老架构.html" class="sidebar-link">结构脉络梳理</a></li><li><a href="/Blog/web/react/调度和时间分片.html" class="sidebar-link">调度与时间片</a></li><li><a href="/Blog/web/react/Fiber架构的心智模型.html" class="sidebar-link">Fiber的心智模型</a></li><li><a href="/Blog/web/react/Fiber架构的实现原理.html" class="sidebar-link">Fiber架构的实现原理</a></li><li><a href="/Blog/web/react/Fiber架构的工作原理.html" class="sidebar-link">Fiber架构的工作原理</a></li><li><a href="/Blog/web/react/事件原理.html" class="active sidebar-link">事件原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#一、前言" class="sidebar-link">一、前言</a></li><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#二、独特的事件处理" class="sidebar-link">二、独特的事件处理</a></li><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#三、事件合成" class="sidebar-link">三、事件合成</a></li><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#四、事件绑定" class="sidebar-link">四、事件绑定</a></li><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#五、事件触发" class="sidebar-link">五、事件触发</a></li><li class="sidebar-sub-header"><a href="/Blog/web/react/事件原理.html#六、总结" class="sidebar-link">六、总结</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="事件原理"><a href="#事件原理" class="header-anchor">#</a> 事件原理</h1> <h2 id="一、前言"><a href="#一、前言" class="header-anchor">#</a> 一、前言</h2> <h3 id="首先"><a href="#首先" class="header-anchor">#</a> 首先</h3> <p>在React应用中，我们所看到的React事件都是&quot;假的&quot;。假在哪里？</p> <ul><li>给元素绑定的事件，不是真正的事件处理函数。</li> <li>在冒泡/捕获阶段绑定的事件，也不是在冒泡/捕获阶段执行的。</li> <li>甚至在事件处理函数中拿到的事件源e，也不是真正的事件源e。</li></ul> <h3 id="疑问"><a href="#疑问" class="header-anchor">#</a> 疑问</h3> <ul><li>React 为什么有自己的事件系统？</li> <li>什么是事件合成 ？</li> <li>如何实现的批量更新？</li> <li>事件系统如何模拟冒泡和捕获阶段？</li> <li>如何通过 dom 元素找到与之匹配的fiber？</li> <li>为什么不能用 return false 来阻止事件的默认行为？</li> <li>事件是绑定在真实的dom上吗？如何不是绑定在哪里？</li> <li>V17 对事件系统有哪些改变？</li></ul> <p>由于不是绑定在真实的DOM上，所以React需要模拟一套事件流：事件捕获 -&gt; 事件源 -&gt; 事件冒泡, 也包括重写
一下事件源对象event。</p> <h2 id="二、独特的事件处理"><a href="#二、独特的事件处理" class="header-anchor">#</a> 二、独特的事件处理</h2> <h3 id="_2-1冒泡阶段和捕获阶段"><a href="#_2-1冒泡阶段和捕获阶段" class="header-anchor">#</a> 2.1冒泡阶段和捕获阶段</h3> <ul><li>冒泡阶段：开发者正常给React绑定的事件加上onClick，onChange。默认会在模拟冒泡阶段执行。</li> <li>捕获阶段：如果想要在捕获阶段执行可以将事件后面加上Capture后缀，比如onClickCapture，onChangeCapture</li></ul> <h3 id="_2-2阻止冒泡"><a href="#_2-2阻止冒泡" class="header-anchor">#</a> 2.2阻止冒泡</h3> <p>React阻止冒泡和原生事件中的写法差不多，e.stopPropagation()；但底层原理不同。</p> <h3 id="_2-3阻止默认行为"><a href="#_2-3阻止默认行为" class="header-anchor">#</a> 2.3阻止默认行为</h3> <ul><li>原生事件：e.preventDefault()和return false可以用来阻止事件默认行为。</li> <li>React事件: e.preventDefault()阻止事件默认行为，这个方法并非是原生事件的preventDefault,
由于React的事件源e也是独立组建的，所以需要显示调用preventDefault来告诉react来阻止默认行为，所以
return false在react应用中完全失去来作用。</li></ul> <h2 id="三、事件合成"><a href="#三、事件合成" class="header-anchor">#</a> 三、事件合成</h2> <p>React事件系统可分为三个部分：</p> <ul><li>第一部分是在事件合成系统，初始化会注册不同的事件插件。</li> <li>第二部分是在第一次渲染过程中，对事件标签中事件的收集，想container注册事件。</li> <li>第三个部分就是一次用户交互，事件触发，到事件执行的一系列过程。</li></ul> <h3 id="_3-1事件合成概念"><a href="#_3-1事件合成概念" class="header-anchor">#</a> 3.1事件合成概念</h3> <ul><li>React的事件不是绑定在元素上，而是统一绑定在顶部容器上，在V17之前是绑定在document上的，在
V17改变成了app容器。这样更利于一个html下存在多个应用（微前端）。</li> <li>绑定事件并不是一次性绑定所有事件，比如发现了onClick事件，就回绑定click事件，比如发现了onChange事件，
会绑定[blur, change, focus, keydown, keyup]多个事件。</li> <li>React事件合成的概念：React应用中，元素绑定的事件并不是原生事件，而是React合成的事件，比如onClick是由
click合成，onChange是由blur，change，focus等多个事件合成。</li></ul> <h3 id="_3-2-事件插件机制"><a href="#_3-2-事件插件机制" class="header-anchor">#</a> 3.2 事件插件机制</h3> <p>React有一种事件插件机制，比如onClick和onChange，会有不同的事件插件SimpleEventPlugin，
ChangeEventPlugin处理。</p> <p>registration： 登记，注册</p> <h4 id="第一个registrationnamemodules"><a href="#第一个registrationnamemodules" class="header-anchor">#</a> 第一个registrationNameModules：</h4> <div class="language-js extra-class"><pre class="language-js"><code>simple<span class="token operator">:</span> <span class="token string">'简单的'</span>
capture<span class="token operator">:</span> <span class="token string">'捕获'</span>
<span class="token keyword">const</span> registrationNameModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  onBlur<span class="token operator">:</span> SimpleEventPlugin<span class="token punctuation">,</span>
  onClick<span class="token operator">:</span> SimpleEventPlugin<span class="token punctuation">,</span>
  onClickCapture<span class="token operator">:</span> SimpleEventPlugin<span class="token punctuation">,</span>
  onChange<span class="token operator">:</span> ChangeEventPlugin<span class="token punctuation">,</span>
  onChangeCapture<span class="token operator">:</span> ChangeEventPlugin<span class="token punctuation">,</span>
  onMouseEnter<span class="token operator">:</span> EnterEventPlugin<span class="token punctuation">,</span>
  onMouseLeave<span class="token operator">:</span> EnterEventPlugin
<span class="token punctuation">}</span>
</code></pre></div><p>registrationNameModules记录了React事件和与之对应的处理插件的映射。</p> <div class="custom-block tip"><p class="custom-block-title">为什么要用不同的事件插件来处理不同的React事件</p> <p>答：首先对于不用的事件，有不同的处理逻辑；对应的事件源对象也有所不同，React的事件和事件源是自己合成的，
所以对于不同事件需要不同的事件插件处理。</p></div> <h4 id="第二个registrationnamedependencies"><a href="#第二个registrationnamedependencies" class="header-anchor">#</a> 第二个registrationNameDependencies</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  onBlur<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blur'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  onClick<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  onClickCapture<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  onChange<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token string">'selectionchange'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  onMouseEnter<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> <span class="token string">'mouseover'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  onMouseLeave<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> <span class="token string">'mouseover'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个对象保存了React事件和原生事件对应关系，这就解释了为什么上述只写了一个onChange，会有很多的原生
事件绑定在document上。在事件绑定阶段，如果发现有React事件，比如onChange，就会找到对应的原生事件数组，逐一绑定。</p> <h2 id="四、事件绑定"><a href="#四、事件绑定" class="header-anchor">#</a> 四、事件绑定</h2> <p>所谓事件绑定，就是在React处理props时候，如果遇到事件比如onClick，就会通过addEventListener注册原生事件，
例如onClick最后去了哪里？</p> <p>最后去了fiber下memoizedProps属性上，如上结构会变成这样。
<img src="/Blog/assets/img/memoizeProps.3da08142.png" alt="memoizedProps">;</p> <h2 id="五、事件触发"><a href="#五、事件触发" class="header-anchor">#</a> 五、事件触发</h2> <p>一次点击事件</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> handleClick3 <span class="token punctuation">}</span></span>  <span class="token attr-name">onClickCapture</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> handleClick4 <span class="token punctuation">}</span></span>  <span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> handleClick1 <span class="token punctuation">}</span></span>  <span class="token attr-name">onClickCapture</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> handleClick2 <span class="token punctuation">}</span></span>  <span class="token punctuation">&gt;</span></span><span class="token plain-text">点击</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-1-批量更新"><a href="#_5-1-批量更新" class="header-anchor">#</a> 5.1 批量更新</h3> <p><img src="/Blog/assets/img/dom-fiber.822d9e77.png" alt="fiber-dom">;
<img src="/Blog/assets/img/clickLifeCycle_1.ce1716d7.png" alt="clickLifeCycle1">;</p> <h3 id="_5-2-合成事件源"><a href="#_5-2-合成事件源" class="header-anchor">#</a> 5.2 合成事件源</h3> <p><img src="/Blog/assets/img/clickLifeCycle_2.a8765945.png" alt="clickLifeCycle2"></p> <h3 id="_5-3-形成事件执行队列"><a href="#_5-3-形成事件执行队列" class="header-anchor">#</a> 5.3 形成事件执行队列</h3> <p><img src="/Blog/assets/img/clickLifeCycle_3.e3606d8c.png" alt="clickLifeCycle3">;</p> <h3 id="_5-4-react如何模拟阻止事件冒泡"><a href="#_5-4-react如何模拟阻止事件冒泡" class="header-anchor">#</a> 5.4 react如何模拟阻止事件冒泡</h3> <p>::: tips legacy-events/EventBatching.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">runEventsInBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> dispatchListeners <span class="token operator">=</span> event<span class="token punctuation">.</span>_dispatchListeners<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>dispatchListeners<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dispatchListeners<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">isPropagationStopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 判断是否已经阻止事件冒泡 */</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>    
      dispatchListeners<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token comment">/* 执行真正的处理函数 及handleClick1... */</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>:::</p> <h2 id="六、总结"><a href="#六、总结" class="header-anchor">#</a> 六、总结</h2> <ul><li>React为什么有自己的事件系统？</li></ul> <p>答：因为对于不同的浏览器，对事件存在不同的兼容性，React想实现一个兼容全浏览器的框架，为了实现这个目标，
就需要创建一个兼容全浏览器的事件系统，以此抹平不同浏览器的差异。</p> <ul><li>V17对事件系统有哪些改变？</li> <li>事件是绑定在真实的dom上嘛？如果不是绑定在哪里？</li></ul> <p>答：<strong>V17之前React事件都绑定在document上，V17之后React把事件绑定在应用对应的容器container上</strong>，
将事件绑定在同一容器统一管理，防止很多事件直接绑定在原生的DOM元素上。造成一些不可控的情况。</p> <ul><li>什么是事件合成
答：在React应用中，元素的绑定并不是原生事件，而是React合成的事件，比如onClick是由click合成，
onChange是有blur，change，focus等多个事件合成。比如原生的checkbox、select没有onChange事件</li></ul> <ol><li>什么是事件合成。</li> <li>如何模拟事件捕获和事件冒泡阶段。</li> <li>如何处理事件源对象。</li> <li>一次点击到事件执行都发生了什么。</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/31/2021, 9:34:48 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/web/react/Fiber架构的工作原理.html" class="prev">
        Fiber架构的工作原理
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.f375fe27.js" defer></script><script src="/Blog/assets/js/2.c88ae757.js" defer></script><script src="/Blog/assets/js/3.acab97b8.js" defer></script>
  </body>
</html>
