(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{428:function(t,a,s){"use strict";s.r(a);var r=s(45),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"错误监控以及上报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误监控以及上报"}},[t._v("#")]),t._v(" 错误监控以及上报")]),t._v(" "),s("h2",{attrs:{id:"_1、如何设计-5w1h"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、如何设计-5w1h"}},[t._v("#")]),t._v(" 1、如何设计 5W1H")]),t._v(" "),s("ul",[s("li",[t._v("What: 发生了什么错误：逻辑错误、数据错误、网络错误、语法错误")]),t._v(" "),s("li",[t._v("When: 出现的时间段，如时间戳")]),t._v(" "),s("li",[t._v("Who: 影响来多少用户，包括报错事件数、IP、设备信息。")]),t._v(" "),s("li",[t._v("Where: 出现的页面是哪些，包括页面、广告栈、媒体")]),t._v(" "),s("li",[t._v("Why: 错误的原因是什么，报错错误堆栈、行列、SourceMap")]),t._v(" "),s("li",[t._v("How: 怎么定位解决问题，我们还需要手机系统等信息。")])]),t._v(" "),s("h2",{attrs:{id:"_2、错误类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、错误类型"}},[t._v("#")]),t._v(" 2、错误类型")]),t._v(" "),s("h3",{attrs:{id:"js执行错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js执行错误"}},[t._v("#")]),t._v(" JS执行错误")]),t._v(" "),s("h3",{attrs:{id:"网络错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络错误"}},[t._v("#")]),t._v(" 网络错误")]),t._v(" "),s("ul",[s("li",[t._v("Javascript语法错误，代码异常")]),t._v(" "),s("li",[t._v("AJAX请求异常")]),t._v(" "),s("li",[t._v("静态资源加载异常")]),t._v(" "),s("li",[t._v("Promise异常")]),t._v(" "),s("li",[t._v("跨站脚本错误")]),t._v(" "),s("li",[t._v("页面崩溃")]),t._v(" "),s("li",[t._v("框架错误")])]),t._v(" "),s("h2",{attrs:{id:"_3、收集错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、收集错误"}},[t._v("#")]),t._v(" 3、收集错误")]),t._v(" "),s("h3",{attrs:{id:"_1-try-catch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-try-catch"}},[t._v("#")]),t._v(" 1/try/catch")]),t._v(" "),s("p",[t._v("try/catch可以捕获常规运行时错误，语法错误和异步错误不行。")]),t._v(" "),s("h3",{attrs:{id:"_2-window-onerror"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-window-onerror"}},[t._v("#")]),t._v(" 2/window.onerror")]),t._v(" "),s("p",[t._v("当JS运行时错误发生，window会触发一个ErrorEvent接口的error事件。")]),t._v(" "),s("p",[t._v("可以捕获：常规运行时错误、异步错误")]),t._v(" "),s("p",[t._v("不能捕获：语法错误、资源加载错误")]),t._v(" "),s("h3",{attrs:{id:"_3-window-addeventlistener"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-window-addeventlistener"}},[t._v("#")]),t._v(" 3/window.addEventListener")]),t._v(" "),s("p",[t._v("当一项资源（如图片或脚本）加载失败，加载资源的元素会触发一个 Event 接口的 error 事件，\n这些 error 事件不会向上冒泡到 window，但能被捕获。而window.onerror不能监测捕获。")]),t._v(" "),s("p",[t._v("可以捕获：图片、script、 css加载错误\n不可以捕获: new Image()、fetch请求")]),t._v(" "),s("h3",{attrs:{id:"_4-window-addeventlistener-unhandledrejection-捕获promise的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-window-addeventlistener-unhandledrejection-捕获promise的错误"}},[t._v("#")]),t._v(" 4/window.addEventListener('unhandledrejection'') 捕获promise的错误")]),t._v(" "),s("p",[t._v("当Promise 被 reject 且没有 reject 处理器的时候，会触发 unhandledrejection 事件；\n这可能发生在 window 下，但也可能发生在 Worker 中。 这对于调试回退错误处理非常有用。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 全局统一处理Promise")]),t._v("\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unhandledrejection"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://tuia.cn/test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"_5-页面崩溃"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-页面崩溃"}},[t._v("#")]),t._v(" 5/页面崩溃")]),t._v(" "),s("p",[t._v("可以监听window对象的load和beforeunload事件，并结合sessionStorage对页面崩溃实施监控")]),t._v(" "),s("h3",{attrs:{id:"_6-框架的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-框架的错误"}},[t._v("#")]),t._v(" 6/框架的错误")]),t._v(" "),s("p",[t._v("react使用componentDidCatch来处理错误。")]),t._v(" "),s("p",[t._v("框架会通过console.error的方式来输出，可以劫持console.error来监听这些报错信息。")]),t._v(" "),s("h2",{attrs:{id:"_4、错误上报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、错误上报"}},[t._v("#")]),t._v(" 4、错误上报")]),t._v(" "),s("p",[t._v("考虑的点")]),t._v(" "),s("ul",[s("li",[t._v("独立的域名，跨域")]),t._v(" "),s("li",[t._v("何时上报，在页面稳定后进行上报，不要阻塞页面解析以及渲染。进行合并。")])]),t._v(" "),s("p",[t._v("方案")]),t._v(" "),s("ul",[s("li",[t._v("1*1的gif，最小，不会携带cookie，无跨域问题 new Image();")]),t._v(" "),s("li",[t._v("navigator.sendBeacon();\n详情参考"),s("a",{attrs:{href:"https://juejin.cn/post/6987681953424080926",target:"_blank",rel:"noopener noreferrer"}},[t._v("一篇讲透自研的前端错误监控"),s("OutboundLink")],1),t._v("以及前端开发核心知识进阶")])])])}),[],!1,null,null,null);a.default=e.exports}}]);